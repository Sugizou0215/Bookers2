<main>
	<div class="container px-5 px-sm-0">
	  <div class="row">
			<%#サイドバー%>
			<%= render 'users/sidebar', user: @user, book: @book %>
			<%#投稿一覧%>
			<div class="col-md-8 offset-md-1">
				<h2>Books</h2>
				<table class ="table table-hovor table-inverse">
					<thead>
						<tr>
							<% if @user.id == current_user.id %>
				      	<th>Title</th>
				      	<th>Opinion</th>
				      	<th colspan="3"></th>
    					<% else %>
    						<th></th>
    						<th>Title</th>
				      	<th>Opinion</th>
				      	<th colspan="3"></th>
    					<% end %>
			    	</tr>
					</thead>
					<tbody>
          	<% @books.each do |book| %>
						<tr>
							<% unless @user.id == current_user.id %>
								<td>
									<%= link_to attachment_image_tag(book.user, :profile_image, :fill, 60, 60, fallback: "no_image.jpg"), user_path(@user.id) %>
								</td>
							<% end %>
							<td><%= link_to book.title, book_path(book.id) %></td>
							<td><%= book.body %></td>
							<td>コメント数：<%= book.post_comments.count %></td>
							<%#評価呼び出し%>
            	<%= render 'books/evaluation', book: book %>
						</tr>
					<% end %>
					</tbody>
				</table>
				<%= paginate @books %>
				<h3>投稿数の前日比・前週比</h3>
				<table class="table table-bordered">
			    <thead>
			      <tr>
			      	<th>今日の投稿数</th>
			      	<th>前日の投稿数</th>
			      	<th>前日比</th>
			      </tr>
			    </thead>
			    <tbody>
			      <tr>
			     　 <td><%= @today_book.count %></td>
			     　 <td><%= @yesterday_book.count %></td>
			     　 <td>
			        	<% if @yesterday_book.count == 0 %>
			            前日の投稿はありません
			       		<% else %>
			       　		<% @the_day_before =   @today_book.count / @yesterday_book.count.to_f  %>
			       　		<%= (@the_day_before * 100).round %>
			          <% end %>
			        </td>
			      </tr>
			    </tbody>
			  </table>
				<table class="table table-bordered">
			    <thead>
			      <tr>
			      	<th>今週の投稿数</th>
			      	<th>前週の投稿数</th>
			      	<th>前週比</th>
			      </tr>
			    </thead>
			    <tbody>
			      <tr>
			     　 <td><%= @thisweek_book.count %></td>
			     　 <td><%= @lastweek_book.count %></td>
			     　 <td>
			        	<% if @lastweek_book.count == 0 %>
			            前週の投稿はありません
			       		<% else %>
			       　		<% @the_week_before =   @thisweek_book.count / @lastweek_book.count.to_f  %>
			       　		<%= (@the_week_before * 100).round %>
			          <% end %>
			        </td>
			      </tr>
			    </tbody>
			  </table>
			  <h3>7日間分の投稿数</h3>
			  <table class="table table-bordered">
			    <thead>
			      <tr>
			      	<th>6日前</th>
			      	<th>5日前</th></th>
			      	<th>4日前</th>
			      	<th>3日前</th>
			      	<th>2日前</th>
			      	<th>昨日</th>
			      	<th>今日</th>
			      </tr>
			    </thead>
			    <tbody>
			      <tr>
			     　 <td><%= @six_days_ago_book.count %></td>
			     　 <td><%= @five_days_ago_book.count %></td>
			     　 <td><%= @four_days_ago_book.count %></td>
			     　 <td><%= @three_days_ago_book.count %></td>
			     　 <td><%= @two_days_ago_book.count %></td>
			     　 <td><%= @yesterday_book.count %></td>
			     　 <td><%= @today_book.count %></td>
			      </tr>
			    </tbody>
			  </table>
			  <%#グラフ メモ：表示されない。原因不明。chart.jsが読み込めてない？%>
			  <div><canvas id="booksChart"></canvas></div>
			    <script>
				    var ctx = document.getElementById("booksChart");
				    var booksChart = new Chart(ctx, {
				      type: 'line',
				      datasets: [
				        {
				          label: '投稿した本の数',
				          data: [
				          	1,2,3,4,5,6,7
				          ],
				          borderColor: "rgba(255,0,0,1)",
				          backgroundColor: "rgba(0,0,0,0)"
				        },
				      ],
				    },
				      options: {
				      title: {
				        display: true,
				        text: '7日間の投稿数の比較'
					      },
					      scales: {
					        yAxes: [{
					          ticks: {
					            suggestedMax: 10,
					            suggestedMin: 0,
					            stepSize: 1,
					            callback: function(value, index, values){
					              return  value
					            }
					          }
					        }]
					      },
					    }
				    });
			    </script>

			</div>
		</div>
	</div>
</main>